language: php

env:
    - WEB_PORT_80_TCP_ADDR=localhost

sudo: required
dist: trusty

php:
    - 5.4
    - 5.5
    - 5.6
    - 7.0

matrix:
  fast_finish: true

cache:
  - apt

before_install:
  ############################################################
  # Let us Setup Apache2 for Ubuntu 16.04 with Php 7 and MySQL
  ############################################################
  - sudo apt-get update
  - sudo apt-get install -y --force-yes apache2
  # Add PHP
  - sudo add-apt-repository -y ppa:ondrej/php
  - sudo apt-get update
  - sudo apt-get install -y --force-yes php7.0 libapache2-mod-php7.0 php7.0-fpm
  # Copy our virtual host template to sites-enabled overwriting the default site conf
  - sudo cp travisCI/defaultsite.tpl /etc/apache2/sites-available/000-default.conf
  # Copy basic testing files into /var/www
  - sudo cp www/info.php /var/www/info.php
  - sudo cp www/apache.php /var/www/apache.php
  # Enable mod rewrite module
  - sudo a2enmod rewrite
  # Set ServerName Globally
  - sudo cp travisCI/servername.tpl /etc/apache2/conf-available/servername.conf
  - sudo a2enconf servername
  # Set Server Host Name
  - echo "127.0.0.1    localhost" | sudo tee -a /etc/hosts
  # Set HostName through Networking
  - sudo hostname localhost
  # Restart apache
  - sudo service apache2 restart
  # Restart PHP
  - sudo service php7.0-fpm restart

#before_script:
#  - cd website && composer self-update --rollback && composer install -n --prefer-source
  
script:
  # Do an Apache Config Test
  - sudo apache2ctl configtest &> /dev/stdout
  # Check Apache Version
  - sudo apache2 -v
  # Check if the site responds OK
  - curl -vsf 'http://localhost:80/apache.php' &> /dev/stdout
  # Test if PHP is working
  - curl -vsf 'http://127.0.0.1:80/info.php' &> /dev/stdout
  # Test a Good User-Agent String against our site (later we test bad bots here)
  - curl -A "googlebot" http://127.0.0.1:80/apache.php &> /dev/stdout
  - cat /tmp/error.log
